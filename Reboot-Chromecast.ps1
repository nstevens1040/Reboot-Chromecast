function Reboot-Chromecast
{
    [cmdletbinding()]
    Param(
        [Parameter(Mandatory=$true)]
        [string]$DeviceName="Nick's Bedroom TV"
    )
    $list = [System.Collections.Generic.Dictionary[[string],[string]]]::New()
    $list.Add("Nick's Bedroom TV","$($ENV:CHROMECASTMAC)")
    $proto_data = "c3ludGF4ID0gInByb3RvMyI7CnBhY2thZ2UgZ29vZ2xlLmludGVybmFsLmhvbWUuZm95ZXIudjE7CgovLyBUaGlzIGZpbGUgY29udGFpbnMgdGhlIGZvbGxvd2luZyBzZXJ2aWNlczoKLy8KLy8gSG9tZUNvbnRyb2xTZXJ2aWNlCi8vICAgLSBHZXRBc3Npc3RhbnRSb3V0aW5lcwovLwovLyBTdHJ1Y3R1cmVzU2VydmljZQovLyAgIC0gR2V0SG9tZUdyYXBoCi8vCi8vIEhvbWVEZXZpY2VzU2VydmljZQovLyAgIC0gR2V0QXNzaXN0YW50RGV2aWNlU2V0dGluZ3MKCm1lc3NhZ2UgTm9uZSB7Cn0KCi8vIEhvbWUgQ29udHJvbCBTZXJ2aWNlCnNlcnZpY2UgSG9tZUNvbnRyb2xTZXJ2aWNlIHsKICBycGMgR2V0QXNzaXN0YW50Um91dGluZXMgKE5vbmUpIHJldHVybnMgKHN0cmVhbSBHZXRBc3Npc3RhbnRSb3V0aW5lc1Jlc3BvbnNlKTsKfQoKbWVzc2FnZSBHZXRBc3Npc3RhbnRSb3V0aW5lc1Jlc3BvbnNlIHsKCiAgbWVzc2FnZSBQYXJ0MSB7CiAgICBzdHJpbmcgcm91dGluZV9uYW1lID0gMTsKCiAgICBtZXNzYWdlIFdvcmtGbG93IHsKICAgICAgc3RyaW5nIHR5cGUgPSAxOwoKICAgICAgbWVzc2FnZSBXRl9TdWIxIHsKICAgICAgICBzdHJpbmcgc3RyaW5nMSA9IDE7CgogICAgICAgIG1lc3NhZ2UgV0ZfU3ViMV9TdWIxIHsKICAgICAgICAgIHN0cmluZyBzdHJpbmcxID0gMTsKCiAgICAgICAgICBtZXNzYWdlIFJvdXRpbmUgewogICAgICAgICAgICBzdHJpbmcgcm91dGluZV9pZCA9IDE7CiAgICAgICAgICAgIHVpbnQzMiBudW0yID0gMjsKICAgICAgICAgICAgc3RyaW5nIHJvdXRpbmVfbmFtZSA9IDM7CiAgICAgICAgICB9CgogICAgICAgICAgUm91dGluZSByb3V0aW5lID0gMjsKICAgICAgICB9CgogICAgICAgIFdGX1N1YjFfU3ViMSB3Zl9zMV9zMSA9IDI7CiAgICAgIH0KCiAgICAgIFdGX1N1YjEgd2ZfczEgPSAyOwogICAgfQoKICAgIFdvcmtGbG93IHdvcmtmbG93ID0gMzsKICAgIHN0cmluZyBzdHJpbmc0ID0gNDsKICAgIHN0cmluZyBzdHJpbmc1ID0gNTsKICB9CgogIHJlcGVhdGVkIFBhcnQxIHAxID0gMTsKCiAgbWVzc2FnZSBQYXJ0MiB7CiAgICBzdHJpbmcgc3RyaW5nMSA9IDE7CiAgICBzdHJpbmcgc3RyaW5nMyA9IDM7CiAgfQogIFBhcnQyIHAyID0gMjsKfQoKCi8vIFN0cnVjdHVyZSBTZXJ2aWNlCnNlcnZpY2UgU3RydWN0dXJlc1NlcnZpY2UgewogIHJwYyBHZXRIb21lR3JhcGggKEdldEhvbWVHcmFwaFJlcXVlc3QpIHJldHVybnMgKEdldEhvbWVHcmFwaFJlc3BvbnNlKTsKfQoKbWVzc2FnZSBHZXRIb21lR3JhcGhSZXF1ZXN0IHsKICBzdHJpbmcgc3RyaW5nMSA9IDM7CiAgc3RyaW5nIG51bTIgPSA0Owp9CgptZXNzYWdlIEdldEhvbWVHcmFwaFJlc3BvbnNlIHsKICB1aW50NjQgdGltZXN0YW1wMSA9IDE7CgogIG1lc3NhZ2UgSG9tZSB7CiAgICBzdHJpbmcgaG9tZV9pZCA9IDE7CiAgICBzdHJpbmcgaG9tZV9uYW1lID0gMjsKCiAgICBtZXNzYWdlIExvY2F0aW9uIHsKICAgICAgc3RyaW5nIGFkZHJlc3MgPSAxOwoKICAgICAgbWVzc2FnZSBDb29yZGluYXRlcyB7CiAgICAgICAgZG91YmxlIGxhdGl0dWRlID0gMTsKICAgICAgICBkb3VibGUgbG9uZ2l0dWRlID0gMjsKICAgICAgfQogICAgICBDb29yZGluYXRlcyBjb29yZGluYXRlcyA9IDI7CiAgICAgIHVpbnQ2NCB0aW1lc3RhbXA1ID0gNTsKICAgICAgc3RyaW5nIHRpbWV6b25lID0gNjsKICAgIH0KICAgIExvY2F0aW9uIGxvY2F0aW9uID0gMzsKCiAgICBtZXNzYWdlIExpbmtlZFVzZXIgewogICAgICBzdHJpbmcgZW1haWxfYWRkcmVzcyA9IDE7CiAgICB9CiAgICByZXBlYXRlZCBMaW5rZWRVc2VyIGxpbmtlZF91c2VycyA9IDQ7CgogICAgbWVzc2FnZSBSb29tIHsKICAgICAgc3RyaW5nIHJvb21faWQgPSAxOwogICAgICBzdHJpbmcgcm9vbV9uYW1lID0gMzsKCiAgICAgIG1lc3NhZ2UgQ2F0ZWdvcnkgewogICAgICAgIHN0cmluZyBuYW1lID0gMTsKICAgICAgfQogICAgICBDYXRlZ29yeSBjYXRlZ29yeSA9IDQ7CiAgICB9CiAgICByZXBlYXRlZCBSb29tIHJvb21zID0gNjsKCiAgICBtZXNzYWdlIERldmljZSB7CiAgICAgIG1lc3NhZ2UgRGV2aWNlSW5mbyB7CiAgICAgICAgc3RyaW5nIGRldmljZV9pZCA9IDE7CgogICAgICAgIG1lc3NhZ2UgUHJvamVjdEluZm8gewogICAgICAgICAgc3RyaW5nIGFwaV9wcm9qZWN0X2lkID0gMTsKICAgICAgICAgIHN0cmluZyBzdHJpbmcyID0gMjsKICAgICAgICB9CiAgICAgICAgUHJvamVjdEluZm8gcHJvamVjdF9pbmZvID0gMjsKICAgICAgfQogICAgICBEZXZpY2VJbmZvIGRldmljZV9pbmZvID0gMTsKICAgICAgc3RyaW5nIGRldmljZV9uYW1lID0gNDsKICAgICAgc3RyaW5nIGRldmljZV90eXBlID0gNjsKICAgICAgcmVwZWF0ZWQgc3RyaW5nIHRyYWl0cyA9IDc7CiAgICAgIHN0cmluZyBzdWZmaXggPSAxMDsKCiAgICAgIG1lc3NhZ2UgTWVzc2FnZTEyIHsKICAgICAgICB1aW50MzIgbnVtMiA9IDI7CiAgICAgICAgdWludDMyIG51bTQgPSA0OwogICAgICAgIHVpbnQzMiBudW01ID0gNTsKICAgICAgICB1aW50MzIgbnVtMzcgPSAzNzsKICAgICAgICB1aW50MzIgbnVtMzggPSAzODsKICAgICAgICB1aW50MzIgbnVtNDUgPSA0NTsKICAgICAgICB1aW50MzIgbnVtNDYgPSA0NjsKICAgICAgfQogICAgICBNZXNzYWdlMTIgbWVzc2FnZTEyID0gMTI7CgogICAgICBtZXNzYWdlIE1lc3NhZ2UxNSB7CiAgICAgICAgdWludDY0IG51bTEgPSAxOwogICAgICAgIHVpbnQ2NCBudW01ID0gNTsKICAgICAgICB1aW50NjQgbnVtNiA9IDY7CiAgICAgICAgdWludDY0IG51bTcgPSA3OwogICAgICB9CiAgICAgIE1lc3NhZ2UxNSBtZXNzYWdlMTUgPSAxNTsKCiAgICAgIG1lc3NhZ2UgSGFyZHdhcmUgewogICAgICAgIHN0cmluZyBtb2RlbCA9IDI7CiAgICAgIH0KICAgICAgSGFyZHdhcmUgaGFyZHdhcmUgPSAxNzsKCiAgICAgIG1lc3NhZ2UgTWVzc2FnZTE4IHsKICAgICAgICBzdHJpbmcgZGV2aWNlX25hbWUgPSAyOwogICAgICB9CiAgICAgIE1lc3NhZ2UxOCBtZXNzYWdlMTggPSAxODsKICAgICAgdWludDY0IHRpbWVzdGFtcDE5ID0gMTk7CgogICAgICBtZXNzYWdlIE1lc3NhZ2UyMCB7CiAgICAgICAgbWVzc2FnZSBNZXNzYWdlMSB7CiAgICAgICAgICBzdHJpbmcga2V5ID0gMTsKCiAgICAgICAgICBtZXNzYWdlIFZhbHVlIHsKICAgICAgICAgICAgbWVzc2FnZSBNZXNzYWdlNiB7CiAgICAgICAgICAgICAgbWVzc2FnZSBNZXNzYWdlMSB7CiAgICAgICAgICAgICAgICBtZXNzYWdlIE1lc3NhZ2U1IHsKICAgICAgICAgICAgICAgICAgbWVzc2FnZSBNZXNzYWdlMSB7CiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGNhcGFiaWxpdHkgPSAxOwogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgTWVzc2FnZTIgewogICAgICAgICAgICAgICAgICAgICAgYm9vbCBib29sNCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UyIG1lc3NhZ2UyID0gMjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXBlYXRlZCBNZXNzYWdlMSBtZXNzYWdlMSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBNZXNzYWdlNSBtZXNzYWdlNSA9IDU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIE1lc3NhZ2UxIG1lc3NhZ2UxID0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBNZXNzYWdlNiBtZXNzYWdlNiA9IDY7CiAgICAgICAgICB9CiAgICAgICAgICBWYWx1ZSB2YWx1ZSA9IDI7CiAgICAgICAgfQogICAgICAgIHJlcGVhdGVkIE1lc3NhZ2UxIG1lc3NhZ2UxID0gMTsKICAgICAgfQogICAgICBNZXNzYWdlMjAgbWVzc2FnZTIwID0gMjA7CgogICAgICBtZXNzYWdlIE1lc3NhZ2UyNSB7CiAgICAgICAgYm9vbCBib29sMSA9IDE7CiAgICAgICAgYm9vbCBib29sMiA9IDI7CiAgICAgIH0KICAgICAgTWVzc2FnZTI1IG1lc3NhZ2UyNSA9IDI1OwoKICAgICAgbWVzc2FnZSBMaW5rZWRVc2VyIHsKICAgICAgICBzdHJpbmcgZW1haWxfYWRkcmVzcyA9IDE7CiAgICAgIH0KICAgICAgcmVwZWF0ZWQgTGlua2VkVXNlciBsaW5rZWRfdXNlcnMgPSAyNjsKICAgICAgc3RyaW5nIGxvY2FsX2F1dGhfdG9rZW4gPSAyODsKCiAgICAgIG1lc3NhZ2UgU3RhdGUgewogICAgICAgIHN0cmluZyBuYW1lID0gMTsKICAgICAgICBzdHJpbmcgdmFsdWUgPSAyOwogICAgICB9CiAgICAgIHJlcGVhdGVkIFN0YXRlIHN0YXRlcyA9IDI5OwoKICAgICAgbWVzc2FnZSBNZXNzYWdlMzAgewogICAgICAgIHN0cmluZyBrZXkgPSAxOwogICAgICAgIG1lc3NhZ2UgTWVzc2FnZTIgewogICAgICAgICAgc3RyaW5nIHN0cmluZzEgPSAxOwogICAgICAgICAgbWVzc2FnZSBNZXNzYWdlMiB7CiAgICAgICAgICAgIGJvb2wgYm9vbDQgPSA0OwogICAgICAgICAgfQogICAgICAgICAgTWVzc2FnZTIgbWVzc2FnZTIgPSAyOwogICAgICAgIH0KICAgICAgICBNZXNzYWdlMiBtZXNzYWdlMiA9IDI7CiAgICAgIH0KICAgICAgTWVzc2FnZTMwIG1lc3NhZ2UzMCA9IDMwOwoKICAgICAgbWVzc2FnZSBNZXNzYWdlMzQgewogICAgICAgIGJvb2wgYm9vbDEgPSAxOwogICAgICB9CiAgICAgIE1lc3NhZ2UzNCBtZXNzYWdlMzQgPSAzNDsKICAgICAgdWludDMyIG51bTM3ID0gMzc7CiAgICAgIHN0cmluZyBzdHJpbmc0MSA9IDQxOwogICAgICBzdHJpbmcgc3RyaW5nNDIgPSA0MjsKICAgIH0KICAgIHJlcGVhdGVkIERldmljZSBkZXZpY2VzID0gNzsKCiAgICBtZXNzYWdlIE1lc3NhZ2UxMSB7CiAgICAgIGJvb2wgYm9vbDEgPSAxOwogICAgfQogICAgTWVzc2FnZTExIG1lc3NhZ2UxMSA9IDExOwogICAgc3RyaW5nIHN0cmluZzEyID0gMTI7CgogICAgbWVzc2FnZSBNZXNzYWdlMTMgewogICAgICBtZXNzYWdlIE1lc3NhZ2UxIHsKICAgICAgICAgIG1lc3NhZ2UgRGV2aWNlSW5mbyB7CiAgICAgICAgICBzdHJpbmcgZGV2aWNlX2lkID0gMTsKCiAgICAgICAgICBtZXNzYWdlIFByb2plY3RJbmZvIHsKICAgICAgICAgICAgc3RyaW5nIGFwaV9wcm9qZWN0X2lkID0gMTsKICAgICAgICAgICAgc3RyaW5nIHN0cmluZzIgPSAyOwogICAgICAgICAgfQogICAgICAgICAgUHJvamVjdEluZm8gcHJvamVjdF9pbmZvID0gMjsKICAgICAgICB9CiAgICAgICAgRGV2aWNlSW5mbyBkZXZpY2VfaW5mbyA9IDE7CiAgICAgIH0KICAgICAgTWVzc2FnZTEgbWVzc2FnZTEgPSAxOwogICAgICBzdHJpbmcgZHVvX2NhbGxfdXJsID0gMjsKICAgICAgc3RyaW5nIGR1b19waG9uZV9udW1iZXIgPSAzOwogICAgfQogICAgTWVzc2FnZTEzIG1lc3NhZ2UxMyA9IDEzOwoKICAgIHN0cmluZyBtZXNzYWdlMTQgPSAxNDsKCiAgICBtZXNzYWdlIE1lc3NhZ2UxNSB7CiAgICAgIGJvb2wgYm9vbDEgPSAxOwogICAgICBzdHJpbmcgc3RyaW5nMiA9IDI7CgogICAgICBtZXNzYWdlIE1lc3NhZ2UzIHsKICAgICAgICBzdHJpbmcgc3RyaW5nMSA9IDE7CgogICAgICAgIG1lc3NhZ2UgTWVzc2FnZTIgewogICAgICAgICAgc3RyaW5nIHN0cmluZzEgPSAxOwogICAgICAgIH0KICAgICAgICBNZXNzYWdlMiBtZXNzYWdlMiA9IDI7CiAgICAgIH0KICAgICAgcmVwZWF0ZWQgTWVzc2FnZTMgbWVzc2FnZTMgPSAzOwogICAgICBib29sIGJvb2w0ID0gNDsKICAgIH0KICAgIE1lc3NhZ2UxNSBtZXNzYWdlMTUgPSAxNTsKICB9CiAgSG9tZSBob21lID0gMjsKCiAgbWVzc2FnZSBHcm91cCB7CgogICAgbWVzc2FnZSBEZXZpY2VJbmZvIHsKICAgICAgbWVzc2FnZSBQcm9qZWN0SW5mbyB7CiAgICAgICAgc3RyaW5nIGFwaV9wcm9qZWN0X2lkID0gMTsKICAgICAgICBzdHJpbmcgc3RyaW5nMiA9IDI7CiAgICAgIH0KICAgICAgUHJvamVjdEluZm8gcHJvamVjdF9pbmZvID0gMjsKICAgIH0KICAgIERldmljZUluZm8gZGV2aWNlX2luZm8gPSAxOwoKICAgIHN0cmluZyBncm91cF9ubWFlID0gNDsKICAgIHN0cmluZyBkZXZpY2VfdHlwZSA9IDY7CiAgICBzdHJpbmcgdHJhaXRzID0gNzsKICAgIHN0cmluZyBzdWZmaXggPSAxMDsKCiAgICBtZXNzYWdlIE1lc3NhZ2UxMiB7CiAgICAgIGJvb2wgYm9vbDMgPSAzOwogICAgICBib29sIGJvb2w0ID0gNDsKICAgICAgYm9vbCBib29sMzcgPSAzNzsKICAgICAgYm9vbCBib29sMzggPSAzODsKICAgIH0KICAgIE1lc3NhZ2UxMiBtZXNzYWdlMTIgPSAxMjsKCiAgICBtZXNzYWdlIE1lc3NhZ2UxNSB7CiAgICAgIHN0cmluZyBzdHJpbmcxID0gMTsKICAgICAgdWludDY0IG51bTUgPSA1OwogICAgICB1aW50MzIgbnVtNiA9IDY7CiAgICB9CiAgICBNZXNzYWdlMTUgbWVzc2FnZTE1ID0gMTU7CgogICAgbWVzc2FnZSBNZXNzYWdlMTcgewogICAgICBzdHJpbmcgZ3JvdXBfbW9kZWwgPSAyOwogICAgfQogICAgTWVzc2FnZTE3IG1lc3NhZ2UxNyA9IDE3OwoKICAgIG1lc3NhZ2UgTWVzc2FnZTE4IHsKICAgICAgc3RyaW5nIGdyb3VwX25hbWUgPSAyOwogICAgfQogICAgTWVzc2FnZTE4IG1lc3NhZ2UxOCA9IDE4OwogICAgdWludDY0IHRpbWVzdGFtcDE5ID0gMTk7CgogICAgbWVzc2FnZSBNZXNzYWdlMzQgewogICAgICBib29sIGJvb2wxID0gMTsKICAgIH0KICAgIE1lc3NhZ2UzNCBtZXNzYWdlMzQgPSAzNDsKICB9CiAgcmVwZWF0ZWQgR3JvdXAgZ3JvdXBzID0gMzsKCiAgbWVzc2FnZSBSb29tVHlwZSB7CiAgICBzdHJpbmcgY29kZSA9IDE7CiAgICBzdHJpbmcgbmFtZSA9IDI7CiAgfQogIHJlcGVhdGVkIFJvb21UeXBlIHJvb21fdHlwZXMgPSA0OwoKICBzdHJpbmcgc3RyaW5nNSA9IDU7CiAgYm9vbCBib29sNiA9IDY7CgogIG1lc3NhZ2UgRGV2aWNlVHlwZSB7CiAgICBzdHJpbmcgY29kZSA9IDE7CiAgICBzdHJpbmcgbmFtZSA9IDI7CiAgfQogIHJlcGVhdGVkIERldmljZVR5cGUgZGV2aWNlX3R5cGVzID0gNzsKCiAgbWVzc2FnZSBQcm9qZWN0VHlwZSB7CiAgICBzdHJpbmcgY29kZSA9IDE7CiAgICBzdHJpbmcgbmFtZSA9IDI7CiAgfQogIHJlcGVhdGVkIFByb2plY3RUeXBlIHByb2plY3RfdHlwZXMgPSA5OwoKICBtZXNzYWdlIE1lc3NhZ2UxMSB7CiAgICBzdHJpbmcgbmFtZSA9IDE7CgogICAgbWVzc2FnZSBNZXNzYWdlMiB7CiAgICAgIHVpbnQzMiBudW0yID0gMjsKICAgIH0KICAgIE1lc3NhZ2UyIG1lc3NhZ2UyID0gMjsKICB9CiAgcmVwZWF0ZWQgTWVzc2FnZTExIG1lc3NhZ2UxMSA9IDExOwoKICBtZXNzYWdlIExpbmtlZEFwcCB7CiAgICBzdHJpbmcgc3RyaW5nMSA9IDE7CiAgICBzdHJpbmcgc3RyaW5nMiA9IDI7CiAgICB1aW50MzIgbnVtMyA9IDM7CiAgICB1aW50MzIgbnVtNCA9IDQ7CiAgICB1aW50MzIgbnVtNSA9IDU7CiAgfQogIHJlcGVhdGVkIExpbmtlZEFwcCBsaW5rZWRfYXBwcyA9IDEyOwp9CgoKLy8gSG9tZSBEZXZpY2VzIFNlcnZpY2UKc2VydmljZSBIb21lRGV2aWNlc1NlcnZpY2UgewogIHJwYyBHZXRBc3Npc3RhbnREZXZpY2VTZXR0aW5ncyAoR2V0QXNzaXN0YW50RGV2aWNlU2V0dGluZ3NSZXF1ZXN0KSByZXR1cm5zIChzdHJlYW0gR2V0QXNzaXN0YW50RGV2aWNlU2V0dGluZ3NSZXNwb25zZSk7CiAgcnBjIFVwZGF0ZUFzc2lzdGFudERldmljZVNldHRpbmdzIChVcGRhdGVBc3Npc3RhbnREZXZpY2VTZXR0aW5nc1JlcXVlc3QpIHJldHVybnMgKHN0cmVhbSBVcGRhdGVBc3Npc3RhbnREZXZpY2VTZXR0aW5nc1Jlc3BvbnNlKTsKfQoKbWVzc2FnZSBHZXRBc3Npc3RhbnREZXZpY2VTZXR0aW5nc1JlcXVlc3QgewogIG1lc3NhZ2UgRGV2aWNlSW5mbyB7CiAgICBzdHJpbmcgZGV2aWNlX2lkID0gMTsKCiAgICBtZXNzYWdlIFByb2plY3RJbmZvIHsKICAgICAgc3RyaW5nIGFwaV9wcm9qZWN0X2lkID0gMTsKICAgICAgc3RyaW5nIHN0cmluZzIgPSAyOwogICAgfQogICAgUHJvamVjdEluZm8gcHJvamVjdF9pbmZvID0gMjsKICB9CiAgRGV2aWNlSW5mbyBkZXZpY2VfaW5mbyA9IDE7CiAgc3RyaW5nIHN0cmluZzIgPSAyOwp9CgptZXNzYWdlIEdldEFzc2lzdGFudERldmljZVNldHRpbmdzUmVzcG9uc2UgewogIG1lc3NhZ2UgTWVzc2FnZTEgewogICAgdWludDMyIG51bTEgPSAxOwogICAgdWludDMyIG51bTIgPSAyOwogICAgdWludDMyIG51bTQgPSA0OwogICAgdWludDMyIG51bTUgPSA1OwogICAgdWludDMyIG51bTYgPSA2OwogICAgc3RyaW5nIHN0cmluZzEwID0gMTA7CiAgfQogIE1lc3NhZ2UxIG1lc3NhZ2UxID0gMTsKfQoKbWVzc2FnZSBVcGRhdGVBc3Npc3RhbnREZXZpY2VTZXR0aW5nc1JlcXVlc3QgewogIHN0cmluZyBzdHJpbmcxID0gMTsKCiAgbWVzc2FnZSBEZXZpY2VJbmZvIHsKICAgIHN0cmluZyBkZXZpY2VfaWQgPSAxOwoKICAgIG1lc3NhZ2UgUHJvamVjdEluZm8gewogICAgICBzdHJpbmcgYXBpX3Byb2plY3RfaWQgPSAxOwogICAgICBzdHJpbmcgc3RyaW5nMiA9IDI7CiAgICB9CiAgICBQcm9qZWN0SW5mbyBwcm9qZWN0X2luZm8gPSAyOwogIH0KICBEZXZpY2VJbmZvIGRldmljZV9pbmZvID0gMjsKCiAgbWVzc2FnZSBVcGRhdGVEYXRhIHsKICAgIG1lc3NhZ2UgTWVzc2FnZTEgewogICAgICB1aW50MzIgeW91dHViZV9yZXN0cmljdGVkX21vZGUgPSA0OyAvLyAxPW9mZiwgMj1vbgogICAgICB1aW50MzIgeW91dHViZV90dl9jb250ZW50X2ZpbHRlciA9IDU7IC8vIDE9b2ZmLCAyPW9uCiAgICAgIHN0cmluZyBsb2NhbGUgPSAxMDsgLy8gbG9jYWwgbGlrZSAiZW4tVVMiCiAgICB9CiAgICBNZXNzYWdlMSBtZXNzYWdlMSA9IDE7CiAgfQogIFVwZGF0ZURhdGEgdXBkYXRlX2RhdGEgPSAzOwp9CgptZXNzYWdlIFVwZGF0ZUFzc2lzdGFudERldmljZVNldHRpbmdzUmVzcG9uc2UgewogIHN0cmluZyBzdHJpbmcxID0gMTsKfQ=="
    $proto_file = "$($ENV:TEMP)\protos\google\internal\home\foyer\v1.proto"
    $import_path = "$($ENV:TEMP)\protos\google\internal\home\foyer"
    $chromecast_mac = $list[$DeviceName]
    [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
    $gpsoauth = @(cmd /c "pip.exe list 2>NUL").Where({$_ -match 'gpsoauth'})
    if([String]::IsNullOrEmpty($gpsoauth))
    {
        pip.exe install gpsoauth
    }
    if(!$chromecast_IPAddress)
    {
        $LinkLayer = $chromecast_mac -replace ":","-"
        $chromecast_IPAddress = @(Get-NetNeighbor).Where({$_.LinkLayerAddress -eq $LinkLayer })[0].IPAddress
    }
    if(!("TrustAllCertsPolicy" -as [type]))
    {
        Add-Type -TypeDefinition "using System.Net;`nusing System.Security.Cryptography.X509Certificates;`npublic class TrustAllCertsPolicy : ICertificatePolicy {`n    public bool CheckValidationResult(`n        ServicePoint srvPoint, X509Certificate certificate,`n        WebRequest request, int certificateProblem) {`n        return true;`n    }`n}"
    }
    [System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy
    $get_tokens = "from gpsoauth import perform_master_login, perform_oauth`nfrom uuid import getnode as getmac`nimport json`nimport os`nUSERNAME = os.environ['HOMEGRAPH_SERVICE_ACCOUNT']`nPASSWORD = None`ndevice_id = None`nmaster_token = os.environ['GOOGLE_MASTER_TOKEN']`naccess_token = None`nDEBUG = False`ndef get_master_token(username, password, android_id):`n    res = perform_master_login(username, password, android_id)`n    if DEBUG:`n        print(res)`n    if 'Token' not in res:`n        print('[!] Could not get master token.')`n        return None`n    return res['Token']`n`ndef get_access_token(username, master_token, android_id):`n    res = perform_oauth(`n        username, master_token, android_id,`n        app='com.google.android.apps.chromecast.app',`n        service='oauth2:https://www.google.com/accounts/OAuthLogin',`n        client_sig='24bb24c05e47e0aefa68a58a766179d9b613a600'`n    )`n    if DEBUG:`n        print(res)`n    if 'Auth' not in res:`n        print('[!] Could not get access token.')`n        return None`n    return res['Auth']`n`ndef _get_android_id():`n    mac_int = getmac()`n    if (mac_int >> 40) % 2:`n        raise OSError('a valid MAC could not be determined.'`n                      ' Provide an android_id (and be'`n                      ' sure to provide the same one on future runs).')`n    android_id = _create_mac_string(mac_int)`n    android_id = android_id.replace(':', '')`n    return android_id`n`ndef _create_mac_string(num, splitter=':'):`n    mac = hex(num)[2:]`n    if mac[-1] == 'L':`n        mac = mac[:-1]`n    pad = max(12 - len(mac), 0)`n    mac = '0' * pad + mac`n    mac = splitter.join([mac[x:x + 2] for x in range(0, 12, 2)])`n    mac = mac.upper()`n    return mac`n`nif not device_id:`n    device_id = _get_android_id()`n`nif not master_token:`n    master_token = get_master_token(USERNAME, PASSWORD, device_id)`n`nif not access_token:`n    access_token = get_access_token(USERNAME, master_token, device_id)`n`nx =  {`n    'master_token': master_token,`n    'access_token': access_token`n}`n`ny = json.dumps(x,indent=4)`nprint(y)"
    $out = python.exe -c $get_tokens
    $t = $out | ConvertFrom-Json
    if(![IO.Directory]::Exists($import_path))
    {
        $null = mkdir $import_path
    }
    [Io.File]::WriteAllBytes($proto_file,[System.Convert]::FromBase64String($proto_data))
    $r = . grpcurl.exe  -H "authorization: Bearer $($t.access_token)" -import-path $import_path `
    -proto $proto_file googlehomefoyer-pa.googleapis.com:443 google.internal.home.foyer.v1.StructuresService/GetHomeGraph
    Remove-Item -Recurse -Force "$($ENV:TEMP)\protos"
    $o = $r | ConvertFrom-Json
    $auth_cc = $o.home.devices.Where({$_.deviceName -eq $DeviceName})[0].localAuthToken
    $headers = @{"cast-local-authorization-token"=$auth_cc;}
    $o = irm -Uri "https://$($chromecast_IPAddress):8443/setup/eureka_info?params=version,audio,name,build_info,detail,device_info,net,wifi,setup,settings,opt_in,opencast,multizone,proxy,night_mode_params,user_eq,room_equalizer,sign,aogh,ultrasound,mesh&options=detail,sign" `
    -Headers $headers `
    -Method Get
    .  curl.exe "https://$($chromecast_IPAddress):8443/setup/reboot" -L -d '{\"params\":\"now\"}' --insecure -H Content-Type:application/json -H cast-local-authorization-token:$auth_cc
}
